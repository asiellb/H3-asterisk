[general]
writeprotect=yes
autofallthrough=yes
clearglobalvars=yes
;
; You can include other config files, use the #include command
; (without the ';'). Note that this is different from the "include" command
; that includes contexts within other contexts. The #include command works
; in all asterisk configuration files.
;#include "filename.conf"

; The "Globals" category contains global variables that can be referenced
; in the dialplan with the GLOBAL dialplan function:
; ${GLOBAL(VARIABLE)}
; ${${GLOBAL(VARIABLE)}} or ${text${GLOBAL(VARIABLE)}} or any hybrid
; Unix/Linux environmental variables can be reached with the ENV dialplan
; function: ${ENV(VARIABLE)}
;
[globals]
CONSOLE=Console/dsp				; Console interface for demo

[outbound]
exten => 400,1,GoTo(switchroom,s,1);
exten => 401,1,GoTo(message-recording,s,1)
exten => 402,1,GoTo(grant-workline,s,1);
exten => 403,1,GoTo(danny,s,1);
exten => 404,1,GoTo(hans,s,1);
exten => 405,1,GoTo(dalong,s,1);
exten => _1NXXNXXXXXX,1,dial(sip/rapidlink/${EXTEN})
exten => _NXXNXXXXXX,1,dial(sip/gcns/1${EXTEN})

[inbound]
exten => 169036,1,GoTo(dalong,s,1);

exten => 8572219144,1,GoTo(message-recording,s,1)
exten => 2132336388,1,GoTo(grant-workline,s,1)
exten => 7189071057,1,GoTo(sbn-support,s,1)
exten => 18667148093,1,GoTo(message-recording,s,1)
exten => 8667148093,1,GoTo(message-recording,s,1)

exten => _NXXNXXXXXX,1,macro(DoNotCall)
exten => _1NXXNXXXXXX,1,macro(DoNotCall)

[grant-workline]
exten => s,1,answer
exten => s,n,gotoIfTime(0:00-11:00|*|*|*?VMail)
exten => s,n,gotoIfTime(22:00-23:59|*|*|*?VMail)
exten => s,n,dial(sip/grant,30)
exten => s,n(VMail),VoiceMail(101@sbn)
exten => s,n,hangup

[grant-directVM]
exten => s, 1, answer
exten => s, n, VoiceMail(101@sbn)
exten => s, n, hangup

[dalong]
exten => s, 1, answer
exten => s, n, ringing
exten => s, n, wait(2)
exten => s, n, dial(sip/hans,30)
exten => s, n, VoiceMail(103@sbn,su)
exten => s, n, hangup

[hans]
exten => s, 1, answer
exten => s, n, ringing
exten => s, n, wait(2)
exten => s, n, dial(sip/hans,30)
exten => s, n, VoiceMail(100@sbn)
exten => s, n, hangup

[danny]
exten => s, 1, answer
exten => s, n, ringing
exten => s, n, wait(2)
exten => s, n, dial(sip/danny,30)
exten => s, n, VoiceMail(102@sbn)
exten => s, n, hangup

[switchroom]
exten => s, 1, answer
exten => s, n, ringing
exten => s, n, wait(2)
exten => s, n, dial(sip/switchroom,30)
exten => s, n, VoiceMail(100@sbn)
exten => s, n, hangup

[sbn-support]
exten => s, 1, noop("sbn-support started")
exten => s, n, answer
exten => s, n, ringing
exten => s, n, wait(2)
;exten => s, n, dial(sip/hans,30)
exten => s, n, VoiceMail(100@sbn)
exten => s, n, hangup

[macro-DoNotCall]
exten => s, 1, answer
exten => s, n, ringing
exten => s, n, wait(1) 
exten => s, n, set(DNCExten=${MACRO_EXTEN})
exten => s, n, playback(sbn/LenDNC/you-are-calling-from)
exten => s, n, saydigits(${CALLERID(num)})
exten => s, n, set(DNCNumber=${CALLERID(num)})
exten => s, n(qcid), read(UseCid,sbn/LenDNC/p1-for-cid-p2-for-number,1)
exten => s, n, gotoif($[${UseCid} == 1]?DoNotCall)
exten => s, n, gotoif($[${UseCid} == 2]?ReadNum)
exten => s, n, playback(sbn/LenDNC/invalid-option)
exten => s, n, goto(qcid)
exten => s, n(ReadNum), read(DNCNumber,sbn/LenDNC/enter-10digit-number,10)
exten => s, n(DoNotCall), agi(agi://10.9.2.1:4573/RemoveCustDNC)
exten => s, n, saydigits(${DNCNumber})
exten => s, n, playback(sbn/LenDNC/has-been-removed&sbn/LenDNC/thanks-bye)
exten => s, n, hangup

[message-recording]
exten => s, 1, answer
exten => s, n, ringing
exten => s, n, wait(2) 
exten => s, n(EnterCode), read(MsgRecEnteredCode,sbn/MsgRec/enter-4digit-dialin-code,4)
exten => s, n, gotoif($[${MsgRecEnteredCode} == 0]?CallHome)
exten => s, n, set(MsgRecProjectId=${DB(MsgRec/${MsgRecEnteredCode})})
exten => s, n, gotoif($[${MsgRecProjectId} > 0]?StartRec)
exten => s, n, playback(sbn/MsgRec/invalid-dialin-code)
exten => s, n, goto(s,EnterCode)
exten => s, n(StartRec), noop(${DB_RESULT})
exten => s, n, playback(sbn/MsgRec/record-after-tone)
exten => s, n, record(/tmp/MsgRec-${MsgRecEnteredCode}:ulaw,4,0,skip)
exten => s, n, playback(sbn/MsgRec/you-recorded)
exten => s, n, playback(/tmp/MsgRec-${MsgRecEnteredCode})
exten => s, n(Confirm), read(MsgRecConfirmed,sbn/MsgRec/rerecord-by-pressing1-accept-press2,1)
exten => s, n, gotoif($[1 == ${MsgRecConfirmed}]?StartRec)
exten => s, n, system(/usr/bin/scp -P 8946 /tmp/MsgRec-${MsgRecEnteredCode}.ulaw www-data@216.66.234.250:/dialer/projects/_${MsgRecProjectId}/voiceprompts/MsgRec-${MsgRecEnteredCode}.vox)
exten => s, n, noop(${DB_DELETE(MsgRec/${MsgRecEnteredCode})})
exten => s, n, playback(sbn/MsgRec/saved-successfully)
exten => s, n, hangup
exten => s, n(CallHome), Dial(sip/rapidlink/19494542348)
exten => s, n, hangup

